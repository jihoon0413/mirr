<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/default_layout}"
      layout:fragment="content">

    <head>
        <meta charset='utf-8' />
    </head>
    <body>
    <div th:replace="~{fragments/detailModal :: detailModal}"></div>
    <div th:replace="~{fragments/recordNewModal :: recordNewModal}"></div>
    <div class="container pt-4">
        <button>상세 기록 보기</button>
        <br><br>
        <table class="table table-bordered">
            <thead>
            <tr>
                <th>Quarter</th>
                <th>Opponent</th>
                <th>Point</th>
                <th>LostPoint</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="quarter:${gameDetailList}">
                <td th:text="${quarter.quarterNum}"></td>
                <td th:text="${quarter.opponent}"></td>
                <td th:text="${quarter.point}"></td>
                <td th:text="${quarter.losePoint}"></td>
                <td><button type="submit" class="btn btn-primary" th:value="${quarter.id}" th:id="btn_quarter_update">수정</button></td>
                <td><button type="submit" class="btn btn-warning" th:value="${quarter.id}" th:id="btn_quarter_delete">삭제</button></td>
            </tr>
            </tbody>
        </table>

        <div class="buttons">
            <button type="submit" class="btn btn-success" th:value="${gameId}" id="btn_newQuarter">쿼터 추가</button>
            <button type="submit" class="btn btn-danger" th:value="${gameId}" id="btn_delete">게임 삭제</button>
        </div>

    </div>
    <script type="text/javascript">

        // 쿼터 추가
        $(function(){
            $("#btn_newQuarter").click(function(){

                var gameId = document.getElementById('btn_newQuarter').value;
                console.log('게임 아이디 :', gameId);


                document.getElementById('gameId').value = gameId;

                var myModal = new bootstrap.Modal(document.getElementById('recordNewModal'));
                myModal.show();

            });
        });



        // 게임삭제 모든 쿼터 삭제
        $(function(){
            $("#btn_delete").click(function(){
                if(!confirm('삭제하시면 복구할수 없습니다. \n 정말로 삭제하시겠습니까??')){
                    return false;
                }
                var gameId = document.getElementById('btn_delete').value;
                console.log('게임 아이디 :', gameId);
                $.ajax({
                    type:"post",
                    url:'/game/delete/' + gameId,
                    success: function(response) {
                        window.location.href = response;
                    },
                    error: function(xhr, status, error) {
                        console.error("Error:", error);
                    }
                });
            });
        });

        //쿼터 수정
        document.addEventListener('DOMContentLoaded', function () {
            $(function(){
                $(document).on('click', '.btn-primary', function(){
                    var quarterId = $(this).val();
                    console.log('쿼터 수정 게임 아이디:', quarterId);

                    $.ajax({
                        type:"get",
                        url:'/quarter/findById/' + quarterId,
                        success: function(response) {

                            console.log('쿼터 정보:', response);
                            document.getElementById('quarterId').value = quarterId;
                            document.getElementById('quarterNum').value = response.quarterNum;
                            document.getElementById('opponent').value = response.opponent;
                            document.getElementById('point').value = response.point;
                            document.getElementById('losePoint').value = response.losePoint;

                            var myModal = new bootstrap.Modal(document.getElementById('detailModal'));
                            myModal.show();
                        },
                        error: function(xhr, status, error) {
                            console.error("Error:", error);
                        }
                    });



                });
            });
        });




        //쿼터 삭제
        $(function(){
            $(document).on('click', '.btn-warning', function(){
                if(!confirm('삭제하시면 복구할수 없습니다. \n 정말로 삭제하시겠습니까??')){
                    return false;
                }
                var quarterId = $(this).val();
                console.log('쿼터 수정 게임 아이디:', quarterId);
                $.ajax({
                    type:"post",
                    url:'/quarter/delete/' + quarterId,
                    success: function() {
                        location.reload();
                    }
                });
            });
        });

    </script>

    <style>
        .buttons {
            text-align: right;
        }
    </style>

    </body>
</html>